# Invidious YouTube Dynamic IP Updater

This script is designed to monitor changes in your public IPv4 address, and upon detecting a change, it regenerates the required `visitor_data` and `po_token` for the Invidious Docker container. The script logs all actions, including internet connectivity status, IP changes, and the status of the `monitor_ipv4.service`.

## Features

- Monitors IPv4 address changes
- Runs Docker container to generate new session data (`visitor_data`, `po_token`)
- Replaces the session data in the `docker-compose.yaml` file
- Restarts the Invidious Docker service to reflect changes
- Logs all activities with timestamps
- Handles internet connectivity checks and logs any downtime
- Includes a debug mode for detailed logging

## Requirements

- Docker
- `curl` for obtaining the public IP address
- Properly configured Invidious Docker Compose setup
- **A crucial requirement is having Invidious configured and running as a local instance, not a public one.**

## Installation and Configuration

### Step 1: Clone the Repository

You can clone the repository to your local machine by running the following command:

```bash
git clone https://github.com/DartSteven/Invidious-YouTube-Dynamic-IP-Updater.git
```

Navigate to the cloned directory:

```bash
cd Invidious-YouTube-Dynamic-IP-Updater
```

### Step 2: Configure the Script

- **GENERATOR_OUTPUT**: Path to the `generator.txt` file generated by the Docker container.
- **DOCKER_COMPOSE_FILE**: Path to the `docker-compose.yaml` file that will be updated with new session data.
- **DOCKER_COMPOSE_DIR**: Directory where the Docker Compose files are located.
- **DEBUG**: Set to `YES` for detailed logging; otherwise, set to `NO`.

Modify these variables inside the script based on your setup.

### Step 3: Set up the Systemd Service

To enable the automatic execution of this script on system boot or service status change, configure the `monitor_ipv4.service` file. Below is the content of the service file:

```ini
[Unit]
Description=Monitor IP changes and update docker-compose environment
After=network.target

[Service]
Type=simple
ExecStart=/media/lvm/docker/compose/09.Invidious/monitor_ipv4.sh
Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target

```

Copy this content into `/etc/systemd/system/monitor_ipv4.service` on your server.

Enable and start the service using:

```bash
sudo systemctl enable monitor_ipv4.service
sudo systemctl start monitor_ipv4.service
```

### Step 4: Docker and IP Check

- The script continuously monitors your public IPv4 address and compares it with the previous value.
- If the IP changes, it automatically regenerates the session data and restarts the Invidious service.

## Logs

- Logs are stored in the file: `ipv4_visitor-data_po-token.log` in the same directory as the `docker-compose.yaml`.
- Each log entry is timestamped in the format `[Year-Month-Day Hour:Minute:Second]`.
- Logs include connectivity issues, IP changes, service status, and Docker container actions.

## Debugging

- Enable debug mode by setting `DEBUG="YES"` in the script to get more verbose logs for troubleshooting.

## Special Thanks

A big thanks to the Invidious team for their hard work on this project. For any additional details, please refer to their official [installation documentation](https://docs.invidious.io/installation/).
